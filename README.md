
# VCF 基因型缺失处理工具

## 简介

`main.cpp` 是一个用于处理 VCF（Variant Call Format）文件的 C++ 程序。该程序根据给定的缺失率（missing rate），随机选择并替换 VCF 文件中的部分基因型为缺失值（`./.`）。程序使用固定的随机种子 `19991220` 来保证每次运行的可复现性。用户可以通过命令行参数指定输入文件、输出文件、缺失率和缓冲区大小。

## 功能

- **随机缺失基因型**：根据缺失率（`missing_rate`）随机将 VCF 文件中的基因型替换为缺失值 `./.`。
- **缓冲区优化**：用户可以通过命令行参数调整输入和输出文件的缓冲区大小，以提高大文件处理的效率。
- **可复现性**：使用固定的随机种子 `19991220` 确保每次运行的结果一致。

## 依赖

- C++11 或更高版本
- `getopt` 用于命令行参数解析

## 编译

在包含 `main.cpp` 的目录下，使用以下命令编译程序：

```bash
g++ -std=c++11 -o vcf_processor main.cpp
```

这将生成名为 `vcf_processor` 的可执行文件。

## 使用方法

运行该程序时，可以使用以下命令行参数：

```
./vcf_processor -i <输入文件> -o <输出文件> -r <缺失率> -b <缓冲区大小(单位MB)>
```

### 参数说明

- `-i <输入文件>`：指定输入的 VCF 文件。
- `-o <输出文件>`：指定输出的 VCF 文件。该文件将包含修改后的基因型数据。
- `-r <缺失率>`：指定随机缺失的基因型的比例。缺失率应为浮动数值，范围为 0 到 1。例如，`0.1` 表示 10% 的基因型数据将被替换为 `./.`。
- `-b <缓冲区大小>`：指定缓冲区的大小，单位为 MB。默认值为 16MB。该选项可以用来优化处理大文件时的性能。

### 示例命令

1. **默认设置**（使用默认缺失率 0.01 和默认缓冲区大小 16MB）：

```bash
./vcf_processor -i sample.vcf -o output.vcf
```

2. **指定缺失率和缓冲区大小**：

```bash
./vcf_processor -i sample.vcf -o output.vcf -r 0.1 -b 32
```
在这个命令中：
- 缺失率为 10%。
- 缓冲区大小为 32MB。

3. **帮助信息**：

```bash
./vcf_processor -h
```
该命令将显示如何使用该程序的帮助信息。

## 程序细节

### 随机缺失基因型的处理逻辑：

1. 程序通过固定的随机种子 `19991220` 初始化一个随机数生成器（`std::mt19937`）。
2. 每行 VCF 数据被读取并按制表符分割成列，基因型数据从第 10 列（索引为 9）开始处理。
3. 对每个基因型，程序生成一个随机数，若该随机数小于给定的缺失率，则将基因型替换为 `./.`。
4. 最后，将处理后的行写入输出文件。

### 缓冲区优化：

- 程序使用 `pubsetbuf` 设置文件的输入输出缓冲区大小（以字节为单位），默认为 16MB。通过调整缓冲区大小，可以提高程序在处理大文件时的性能。

## 示例 VCF 文件格式

VCF 文件通常由两部分组成：头部（以 `#` 开头）和数据部分。数据部分每行包含多个字段，如 `CHROM`、`POS`、`ID`、`REF`、`ALT`、`QUAL`、`FILTER`、`INFO` 和一个或多个样本的基因型。

示例数据行：

```
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  Sample1 Sample2
chr1    101     .       A       T       .       PASS    .       GT      0/1     1/1
chr1    102     .       G       C       .       PASS    .       GT      0/0     1/0
chr1    103     .       T       A       .       PASS    .       GT      0/1     1/1
```

处理后的数据（假设缺失率为 10%）：

```
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  Sample1 Sample2
chr1    101     .       A       T       .       PASS    .       GT      0/1     1/1
chr1    102     .       G       C       .       PASS    .       GT      0/0     ./.
chr1    103     .       T       A       .       PASS    .       GT      ./.
```

## 错误处理

- 如果指定的输入或输出文件无法打开，程序将输出错误信息并退出。
- 如果缺少必需的命令行参数（例如输入文件或输出文件），程序将提示用户正确的使用方法。

## 许可证

该程序是开源的，您可以根据需要修改和分发。
